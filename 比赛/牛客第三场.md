# H 

```
#include <bits/stdc++.h>

using namespace std;

typedef long long LL;
typedef pair<int,int> PII;
typedef pair<LL,LL> PLL;
typedef pair<long double,long double> PDD;

const int N = (int)1e6+5;
const int LOG = 21;
vector<int> graph[N];
int fa[N][LOG];
bool vis[N];
vector<int> path;

void solve(){
    int n,k;
    cin>>n>>k;
    for(int i = 1;i <= n ;i++){
        graph[i].clear();
        vis[i] = false;
    }
    for(int i = 0 ;i <=n;i++){
        for(int j = 0 ; j< LOG;j++){
            fa[i][j] = -1;
        }
    }
    for(int i = 2 ;i<=n;i++){
        int pa;
        cin>>pa;
        fa[i][0] = pa;
        graph[i].push_back(pa);
        graph[pa].push_back(i);
    }
    for(int j = 1;j<=LOG-1;j++){
        for(int i = 1;i <= n;i++){
            if(fa[i][j-1] != -1)
                fa[i][j] = fa[fa[i][j-1]][j-1];
        }
    }
    vis[1] =true;
    for(int i = 0 ;i < k; i++){
        int u,r,l;
        cin>>u>>l>>r;
        if(vis[u]) {
            cout<<l;
            return;
        }


        int temp = u;

        for(int j = LOG - 1;j>=0;j--){
            int pa = fa[temp][j];
            if(pa!= -1 && !vis[pa]){
                temp = pa;

            }
        }
        path.clear();
        int now = u;
        while(1){
            path.push_back(now);
            if(now == temp) break;
            now = fa[now][0];

        }
        reverse(path.begin(),path.end());
        for(int j =l ; j <= r;j++){
            if(path[j-l] == u) {
                cout<<j<<"\n";
                return;
            }
            vis[path[j-l]] = true;
        }


    }

    cout<<"-1\n";

}

int main(){
    ios::sync_with_stdio(false);
    cin.tie(nullptr);
    cout.tie(nullptr);

    int tt = 1;
    // cin>>tt;
    while(tt--){
        solve();
    }
}
```